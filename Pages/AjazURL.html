<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GST HSN Manager</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#f1f5f9; font-family:Inter,system-ui,sans-serif; }
.card { background:#fff; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.08); }
</style>
</head>

<body class="p-4 md:p-8">

<div class="max-w-7xl mx-auto card p-6">

<!-- HEADER -->
<div class="flex flex-col md:flex-row justify-between gap-4 mb-6">
  <div>
    <h1 class="text-3xl font-extrabold text-slate-900">GST Rates â€“ HSN</h1>
    <p class="text-slate-500">JSON Backend CRUD</p>
  </div>

  <div class="flex gap-3">
    <input id="searchBox" placeholder="Search HSN / Description"
      onkeyup="applySearch()"
      class="border-2 border-slate-200 rounded-xl px-4 py-2 w-72 focus:border-blue-500 outline-none">

    <button onclick="openModal()"
      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl font-bold">
      + Add New
    </button>
  </div>
</div>

<!-- TABLE -->
<div class="overflow-x-auto rounded-xl border">
<table class="min-w-full divide-y divide-slate-200">
<thead class="bg-slate-50">
<tr>
  <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">HSN</th>
  <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">Description</th>
  <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">GST%</th>
  <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">CGST%</th>
  <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">SGST%</th>
  <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">IGST%</th>
  <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">Action</th>
</tr>
</thead>
<tbody id="rows" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
<div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl">

<div class="flex justify-between items-center px-6 py-4 border-b bg-slate-50">
  <h2 id="modalTitle" class="text-xl font-bold">Add HSN</h2>
  <button onclick="closeModal()" class="text-2xl text-slate-400">&times;</button>
</div>

<div class="p-6 space-y-4">
  <input type="hidden" id="editId">

  <div>
    <label class="text-xs font-bold text-slate-500">HSN</label>
    <input id="hsn" class="w-full border-2 border-slate-200 rounded-xl px-4 py-2">
  </div>

  <div>
    <label class="text-xs font-bold text-slate-500">Description</label>
    <input id="desc" class="w-full border-2 border-slate-200 rounded-xl px-4 py-2">
  </div>

  <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
    <label class="text-sm font-bold text-blue-700">GST %</label>
    <input id="gst" oninput="calcSplit()"
      class="w-full border-2 border-blue-300 rounded-xl px-4 py-2 text-xl font-bold">
  </div>

  <div class="grid grid-cols-3 gap-3 bg-slate-50 p-4 rounded-xl">
    <div><label class="text-[10px] font-bold text-slate-400">CGST%</label><input id="cgst" readonly class="w-full bg-transparent font-bold"></div>
    <div><label class="text-[10px] font-bold text-slate-400">SGST%</label><input id="sgst" readonly class="w-full bg-transparent font-bold"></div>
    <div><label class="text-[10px] font-bold text-slate-400">IGST%</label><input id="igst" readonly class="w-full bg-transparent font-bold"></div>
  </div>

  <div class="flex justify-end gap-3 pt-4">
    <button onclick="closeModal()" class="px-6 py-2 rounded-xl border font-bold text-slate-500">Cancel</button>
    <button onclick="save()" class="px-8 py-2 rounded-xl bg-blue-600 text-white font-bold">
      Save
    </button>
  </div>
</div>
</div>
</div>

<script>
/* ===== CONFIG ===== */
const API_URL =
'https://script.google.com/macros/s/AKfycbzkBVz0Qza9KOD4wRQXm0MQEThl5auSGdjqd60Ja-NpMrzyZwjhADeLIijCwTQRnXQ/exec';


let ALL_DATA = [];

/* ===== API ===== */
function api(action, payload = {}) {
  return fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({ action, ...payload })
  }).then(r => r.json());
}

/* ===== LOAD ===== */
function load() {
  api('read').then(d => {
    ALL_DATA = Array.isArray(d) ? d : [];
    render(ALL_DATA);
  });
}

/* ===== RENDER ===== */
function render(data) {
  const byHSN = {};
  data.forEach(r => {
    if (!byHSN[r.HSN]) byHSN[r.HSN] = [];
    byHSN[r.HSN].push(r);
  });

  rows.innerHTML = data.length
    ? data.map(r => {
        const isDup = byHSN[r.HSN].length > 1;

        const hsnStyle = isDup
          ? 'background:black;color:yellow;font-weight:bold'
          : '';

        const gstStyle = isDup
          ? 'background:black;color:white;font-weight:bold'
          : '';

        return `
        <tr class="hover:bg-slate-50">
          <td class="px-4 py-3" style="${hsnStyle}">${r.HSN}</td>
          <td class="px-4 py-3">${r.Description}</td>
          <td class="px-4 py-3 text-center" style="${gstStyle}">${r.GST_Rate}</td>
          <td class="px-4 py-3 text-center">${r.CGSTPercent}</td>
          <td class="px-4 py-3 text-center">${r.SGSTPercent}</td>
          <td class="px-4 py-3 text-center">${r.IGSTPercent}</td>
          <td class="px-4 py-3 text-center">
            <button onclick='edit(${JSON.stringify(r)})'
              class="text-blue-500 font-bold px-2">Edit</button>
            <button onclick='del(${r.HSN_Index})'
              class="text-red-400 font-bold px-2">Delete</button>
          </td>
        </tr>`;
      }).join('')
    : `<tr><td colspan="7" class="p-8 text-center text-slate-400">No records</td></tr>`;
}

/* ===== SEARCH ===== */
function applySearch() {
  const q = searchBox.value.toLowerCase();
  render(
    !q ? ALL_DATA : ALL_DATA.filter(r =>
      String(r.HSN).includes(q) ||
      String(r.Description).toLowerCase().includes(q)
    )
  );
}

/* ===== MODAL ===== */
function openModal() {
  modal.classList.replace('hidden', 'flex');
  modalTitle.innerText = 'Add HSN';
  editId.value = hsn.value = desc.value = gst.value =
  cgst.value = sgst.value = igst.value = '';
}

function closeModal() {
  modal.classList.replace('flex', 'hidden');
}

function edit(r) {
  openModal();
  modalTitle.innerText = 'Edit HSN';
  editId.value = r.HSN_Index;
  hsn.value = r.HSN;
  desc.value = r.Description;
  gst.value = r.GST_Rate;
  calcSplit();
}

/* ===== SAVE ===== */
function save() {
  const payload = {
    HSN: hsn.value.trim(),
    Description: desc.value.trim(),
    GST_Rate: gst.value
  };

  const req = editId.value
    ? api('update', { data: { ...payload, HSN_Index: editId.value } })
    : api('create', { data: payload });

  req.then(() => {
    closeModal();
    load();
  });
}

/* ===== DELETE ===== */
function del(id) {
  if (!confirm('Delete record?')) return;
  api('delete', { id }).then(() => load());
}

/* ===== GST SPLIT ===== */
function calcSplit() {
  const g = parseFloat(gst.value) || 0;
  cgst.value = sgst.value = (g / 2).toFixed(2);
  igst.value = g.toFixed(2);
}

/* ===== INIT ===== */
load();
</script>

</body>
</html>
